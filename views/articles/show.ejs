<% include ../partials/header %>
<div class="container">
    
    <div class="row">
        <div class="col-md-12" >
            <p class="lead product-header">Article</p>
        </div>
        <div class="col-md-12" >
            <p class="lead product-title"><%=article.name%></p>
        </div>

        <div class="row product flexbox">
            <div class="col-md-4 product-grid">
                <img class="img-responsive product-image" src="<%= article.image %>">
            </div>
            <div class="col-md-4 product-grid">
               
                <div class ="row">
                    <div class="col-md-6">
                        <h4 class="product-item">Id Produit : <%= article._id %></h4>
                    </div>  
                </div>
                <div class ="row">
                     <div class="col-md-6">
                        <h4 class="product-item">Prix de vente : &nbsp;<span class="product-price"><%= article.cost %> &euro;</span></h4>
                    </div>  
                </div>

                <% if((currentUser && article.author.id.equals(currentUser._id)) || (currentUser && currentUser.isAdmin)){ %>
                    <div class ="row">
                        <div class="col-md-6">
                            <a class="btn btn-xs btn-warning" href="/articles/<%= article._id %>/edit">Edit</a>
                            <form id="delete-form" action="/articles/<%= article._id %>?_method=DELETE" method="POST">
                                <button class="btn btn-xs btn-danger">Delete</button>
                            </form>
                        </div>  
                    </div>                             
                <% }%>

                <div class ="row">
                     <div class="col-md-6">
                        <h4 class="product-item">Vendu par : <a href="/users/<%= article.author.id %>"><%= article.author.username %></a>
                        <img class="img-circular"></h4>
                    </div>  
                </div>      
                
                <div class ="row">
                     <div class="col-md-6">
                        <div class="green"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><strong> En stock,</strong> expédition aujourd'hui</div>
                    </div>  
                </div>      
                <div class ="row">
                     <div class="col-md-6">
                        <button class="btn btn-add-cart"><a href="/add-to-cart/<%= article._id %>">Ajouter au panier</a></button>
                    </div>  
                </div>                  
                
                
                <div class ="row">
                     <div class="col-md-12 ">
                        <h4 class="product-item">Description du produit :</h4>
                        <p>
                            <%= article.description %>
                        </p>
                    </div>  
                </div>  
            </div> 
            <div class="col-md-4 product-grid product-meta">
                <strong>DESCRIPTION</strong>
                <p>Culotte en dentelle et microfibre</p>
                <p>En dentelle et microfibre</p>
                <p>Nœud avec bijou devant</p>
                <p>Fond doublé coton</p>
                <strong>COMPOSITION</strong>
                <p>Majorité de fibres synthétiques</p>
                <p>-toa href="#"><strong>Comment faire</strong></a></p>
                <strong>Couleurs</strong>
            </div>

        </div>


        
        <!-- AVIS CLIENTS -->
        <div class="col-md-12 product-section">
            <p class="product-title">Commentaires et avis</p>

            <div class="well">
                <div class="text-right">
                    <a class="btn btn-success btn-add-comment" href="/articles/<%= article._id %>/comments/new">Add New Comment</a>
                </div>
                <hr>
                <% article.comments.forEach(function(comment){ %>
                    <div class="row">
                        <div class="col-md-12 product-comment" >
                            <strong><a href="/users/<%= comment.author.id %>"><%= comment.author.username %></a></strong>
                            <span class="pull-right">10 days ago</span>
                            <p>
                                <%= comment.text %> 
                            </p>
                        <% if((currentUser && comment.author.id.equals(currentUser._id)) || (currentUser && currentUser.isAdmin)){ %>
                            <a class="btn btn-xs btn-warning" 
                               href="/articles/<%=article._id %>/comments/<%=comment._id %>/edit">Edit</a>
                            <form id="delete-form" action="/articles/<%=article._id %>/comments/<%=comment._id %>?_method=DELETE" method="POST">
                                <input type="submit" class="btn btn-xs btn-danger" value="Delete">
                            </form>
                        <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>        
         </div>
        <!-- AUTRES ITEMS -->
        <div class="col-md-12 product-section">
            <p class="product-title">Autres articles de <%=article.author.username%></p>
        </div>
        
        <!-- Carousel
        ================================================== -->
        <% listArticles.forEach(function(article) { %>
            <span style="visibility:hidden;"><a href='/articles/<%= article._id %>'><img class="im" width="0px" src=<%= article.image %>></a></span>
        <% }); %>
        <div id="myCarousel" class="carousel slide col-md-12 product-title">
          <!-- Indicators -->
          <ol class="carousel-indicators">
          </ol>
          <div class="carousel-inner">
           
          </div>
          <!-- Controls -->
          <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="icon-prev"></span>
          </a>
          <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="icon-next"></span>
          </a>  
        </div>
        <!-- /.carousel -->    
        
    </div>
</div>    
<script>
      
$(document).ready(function(){  
    
    // avatar
    var avatar = "<%=user.avatar %>";
    var id = "<%=user.id %>";
    if (avatar) {
        // alert (id);
        $('.img-circular').css('background-image', "url(" + avatar +")");
        $('.img-circular').css('href', "url(/users/" + id +")");
    }
    
    $('#heading-banner').css('display', 'none');
    var linkArray = $("img.im").map(function() {
        return $(this).attr('src');
    }).get();
    // console.log(linkArray);

    for(var i=0 ; i< linkArray.length ; i++) {
        $('<div class="item"><img src="'+linkArray[i]+'"><div class="carousel-caption"></div>   </div>').appendTo('.carousel-inner');
        $('<li data-target="#carousel-example-generic" data-slide-to="'+i+'"></li>').appendTo('.carousel-indicators');
    }
    $('.item').first().addClass('active');
    $('.carousel-indicators > li').first().addClass('active');
    $('#carousel-example-generic').carousel();

});        
</script>


<% include ../partials/footer %>