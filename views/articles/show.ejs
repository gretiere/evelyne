<% include ../partials/header %>
<div class="container">
    
    <div class="row">
        <div class="row product flexbox">
            <div class="col-md-6 product-grid">
                <a class=" js-img-viwer" href="<%= article.image %>" >
                    <div class="crop-to-square">
                        <div class="crop-to-square-positioner img-text-overlay">
                            <img class="crop-to-square-img" src="<%= article.image %>" alt="<%= article.nom %>">
                        </div>
                    </div>
                </a>                   

            </div>
            <div class="col-md-6 product-grid">
                <div class="col-md-12" >
                    <p class="lead product-title" style="color:<%= article.couleurTheme %>;"><%=article.nom%></p>
                </div>
                <div class="col-md-12" >
                    <p class="lead product-subtitle" style="color:#546e7a;"><%=article.nomSecondaire%></p>
                </div>               
                 <div class="col-md-12">
                    <h4 class="product-item"><span class="product-price"><%= Number(article.prix).toFixed(2) %> &euro;</span></h4>
                    <h6>plus frais de livraison</h6>
                </div>  

                <% if((currentUser && article.author.id.equals(currentUser._id)) || (currentUser && currentUser.isAdmin)){ %>
                    <div class="col-md-12">
                        <a class="btn btn-xs btn-warning" href="/articles/<%= article._id %>/edit">Modifier</a>
                        <form id="delete-form" action="/articles/<%= article._id %>?_method=DELETE" method="POST">
                            <button class="btn btn-xs btn-danger">Supprimer</button>
                        </form>
                    </div>  
                <% }%>

                <div class="col-md-12">
                    <h4 class="product-item">Vendu par : <a href="/users/<%= article.author.id %>"><%= article.author.username %></a>
                    <img class="img-circular"></h4>
                </div>  

                 <div class="col-md-12">
                    <div class="green"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><strong> En stock,</strong> expédition aujourd'hui</div>
                </div>  
                 <div class="col-md-12">
                    <button class="btn btn-add-cart"><a href="/add-to-cart/<%= article._id %>">Ajouter au panier</a></button>
                </div>  

                <div class="col-md-12">
                    <fieldset class="rating">
                        <input type="radio" id="star5" name="rating" value="5" /><label class = "full" for="star5" title="Awesome - 5 stars"></label>
                        <input type="radio" id="star4half" name="rating" value="4 and a half" /><label class="half" for="star4half" title="Pretty good - 4.5 stars"></label>
                        <input type="radio" id="star4" name="rating" value="4" /><label class = "full" for="star4" title="Pretty good - 4 stars"></label>
                        <input type="radio" id="star3half" name="rating" value="3 and a half" /><label class="half" for="star3half" title="Meh - 3.5 stars"></label>
                        <input type="radio" id="star3" name="rating" value="3" /><label class = "full" for="star3" title="Meh - 3 stars"></label>
                        <input type="radio" id="star2half" name="rating" value="2 and a half" /><label class="half" for="star2half" title="Kinda bad - 2.5 stars"></label>
                        <input type="radio" id="star2" name="rating" value="2" /><label class = "full" for="star2" title="Kinda bad - 2 stars"></label>
                        <input type="radio" id="star1half" name="rating" value="1 and a half" /><label class="half" for="star1half" title="Meh - 1.5 stars"></label>
                        <input type="radio" id="star1" name="rating" value="1" /><label class = "full" for="star1" title="Sucks big time - 1 star"></label>
                        <input type="radio" id="starhalf" name="rating" value="half" /><label class="half" for="starhalf" title="Sucks big time - 0.5 stars"></label>
                    </fieldset>
                </div>




            

                 <div class="col-md-12 ">
                    <p class="product-item"><strong>Description du produit :</strong></p>
                    <p class="product-item">Id Produit : <%= article._id %></p>
                    <p class="product-item">
                        <%= article.description %>
                    </p>
                </div>  
                 <div class="col-md-12 ">
                    <p class="product-item"><strong>Description technique :</strong></p>
                    <p class="product-item">
                        <%= article.descriptionTechnique %>
                    </p>
                </div>        
                <div class="col-md-12 ">
                    <p class="product-item"><strong>Livraison et retours :</strong></p>
                    <p class="product-item">Recevez ceci rapidement ! Prêt à expédier sous 3 jours ouvrés.</p>
                    <p class="product-item">Depuis le pays : France.</p>
                    <p class="product-item">4,95 € de livraison vers France.</p>
                </div>    
                 
            </div> 

        </div>


        
        <!-- AVIS CLIENTS -->
        <div class="col-md-12 product-section">
            <p class="product-title">Commentaires et avis</p>

            <div class="well">
                <div class="text-right">
                    <a class="btn btn-success btn-add-comment" href="/articles/<%= article._id %>/comments/new">Add New Comment</a>
                </div>
                <hr>
                <% article.comments.forEach(function(comment){ %>
                    <div class="row">
                        <div class="col-md-12 product-comment" >
                            <strong><a href="/users/<%= comment.author.id %>"><%= comment.author.username %></a></strong>
                            <span class="pull-right">10 days ago</span>
                            <p>
                                <%= comment.text %> 
                            </p>
                        <% if((currentUser && comment.author.id.equals(currentUser._id)) || (currentUser && currentUser.isAdmin)){ %>
                            <a class="btn btn-xs btn-warning" 
                               href="/articles/<%=article._id %>/comments/<%=comment._id %>/edit">Edit</a>
                            <form id="delete-form" action="/articles/<%=article._id %>/comments/<%=comment._id %>?_method=DELETE" method="POST">
                                <input type="submit" class="btn btn-xs btn-danger" value="Delete">
                            </form>
                        <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>        
         </div>
        <!-- AUTRES ITEMS -->
        <div class="col-md-12 product-section">
            <p class="product-title">Autres articles de <%=article.author.username%></p>
        </div>
        
        <!-- Carousel
        ================================================== -->
        <% listArticles.forEach(function(article) { %>
            <span style="visibility:hidden;"><a href='/articles/<%= article._id %>'><img class="im" width="0px" src=<%= article.image %>></a></span>
        <% }); %>
        <div id="myCarousel" class="carousel slide col-md-12 product-title">
          <!-- Indicators -->
          <ol class="carousel-indicators">
          </ol>
          <div class="carousel-inner">
           
          </div>
          <!-- Controls -->
          <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="icon-prev"></span>
          </a>
          <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="icon-next"></span>
          </a>  
        </div>
        <!-- /.carousel -->    
        
    </div>
</div>    
<script>
      
$(document).ready(function(){  
    
    // avatar
    var avatar = "<%=user.avatar %>";
    var id = "<%=user.id %>";
    if (avatar) {
        // alert (id);
        $('.img-circular').css('background-image', "url(" + avatar +")");
        $('.img-circular').css('href', "url(/users/" + id +")");
    }
    
    $('#heading-banner').css('display', 'none');
    var linkArray = $("img.im").map(function() {
        return $(this).attr('src');
    }).get();
    // console.log(linkArray);

    for(var i=0 ; i< linkArray.length ; i++) {
        $('<div class="item"><img src="'+linkArray[i]+'"><div class="carousel-caption"></div>   </div>').appendTo('.carousel-inner');
        $('<li data-target="#carousel-example-generic" data-slide-to="'+i+'"></li>').appendTo('.carousel-indicators');
    }
    $('.item').first().addClass('active');
    $('.carousel-indicators > li').first().addClass('active');
    $('#carousel-example-generic').carousel();

});        
</script>

    
<script> 
    $(document).ready(function() {
      var imgs = $('.crop-to-square-img'); //jQuery id selector
      imgs.each(function() {
        var img = $(this);
        var width = img.width(); //jQuery width method
        var height = img.height(); //jQuery height method
    
        if (width < height) {
          img.css('max-height', '150%');
    
        } else {
          img.css('max-width', '150%');
          img.css('max-height', 'auto%');
        }
      })
    });
</script> 

    <!-- plugin pour zoomer sur les images-->
<script>
    window.addEventListener('load',function(){
    	new SmartPhoto(".js-img-viwer");
        new SmartPhoto(".js-img-viwer-fit");
    });
</script>


<% include ../partials/footer %>